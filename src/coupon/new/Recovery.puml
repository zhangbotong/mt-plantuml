@startuml
skinparam DatabaseBackgroundColor #FFE6F0
skinparam EntityBackgroundColor #FFE6F0
skinparam sequence {
    ArrowColor black
    LifeLineBorderColor black
    LifeLineBackgroundColor #FFE6F0
    ParticipantBackgroundColor #FFE6F0
}

participant 公共恢复方法 as REC
entity 分布式锁 as DL
entity rule缓存 as RC
database ruleDB as DB
entity 补贴库存耗尽恢复通知MQ as SMQ

REC -> REC: 入参校验：bizKey、quotaType

REC -> DL++: 加分布式锁（bizKey+quotaType）
return

REC -> DB++: 更新rule.depleted_time为0（清除耗尽标识）
return

REC -> RC++: 更新rule缓存
return

alt #E6FFE6 若是补贴库存
    REC -> SMQ: 发送MQ通知补贴库存状态变更【**恢复**】
end

REC -> DL: 释放锁
@enduml
